<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASS11UP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #131720; --secondary-bg: #1b212c; --card-bg: #283040;
            --button-active: #6c5ce7; --text-primary: #ffffff; --text-secondary: #a0a8b9;
            --glow-1: #00aaff; --glow-2: #8A2BE2; --glow-3: #00ffc3;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-primary); overflow-x: hidden; }
        
        .loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--primary-bg); z-index: 1000; display: flex; align-items: center; justify-content: center; transition: opacity 0.3s; }
        .loader-overlay.hidden { opacity: 0; pointer-events: none; }
        .spinner { width: 50px; height: 50px; border: 5px solid var(--card-bg); border-top-color: var(--button-active); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .page { display: none; min-height: 100vh; }
        .page.active { display: block; animation: page-enter 0.5s ease-out; }
        @keyframes page-enter { from { transform: scale(0.98); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .main-container { padding: 20px; }
        .page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .page-header .header-left, .page-header .header-right { flex-basis: 40px; }
        .page-header .header-right { text-align: right; }
        .page-header .icon-btn { font-size: 22px; cursor: pointer; color: var(--text-primary); }
        .page-header .logo { height: 40px; width: 40px; border-radius: 50%; object-fit: cover; }
        .glowing-title {
            flex-grow: 1; text-align: center; font-size: 22px; font-weight: 700; color: transparent; text-transform: uppercase;
            background: linear-gradient(90deg, var(--glow-1), var(--glow-2), var(--glow-3), var(--glow-1));
            background-size: 200% auto; -webkit-background-clip: text; background-clip: text;
            animation: gradient-flow 8s linear infinite;
            text-shadow: 0 0 3px rgba(255,255,255,0.4), 0 0 8px var(--glow-2);
        }
        @keyframes gradient-flow { to { background-position: -200% center; } }
        
        .inner-page-header { display: flex; align-items: center; margin-bottom: 30px; }
        .inner-page-header .back-arrow { font-size: 22px; cursor: pointer; color: var(--text-primary); margin-right: 20px;}
        .inner-page-header .title { font-size: 24px; font-weight: 600; }
        
        .search-container { position: relative; margin-bottom: 20px; }
        .search-input { width: 100%; background-color: var(--secondary-bg); border: 2px solid transparent; border-radius: 10px; padding: 15px 20px; color: var(--text-primary); font-size: 16px; }
        .tabs { display: flex; background-color: var(--secondary-bg); border-radius: 10px; padding: 5px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; background: none; border: none; color: var(--text-secondary); font-size: 16px; font-weight: 500; border-radius: 8px; cursor: pointer; }
        .tab-btn.active { background-color: var(--button-active); color: white; }

        .sidebar { position: fixed; top: 0; left: -280px; width: 270px; height: 100%; background-color: var(--secondary-bg); transition: left 0.3s; z-index: 200; display: flex; flex-direction: column; padding: 20px 0; }
        .sidebar.open { left: 0; }
        .sidebar-header { text-align: center; padding: 0 20px; margin-bottom: 20px; }
        .sidebar-header .logo { height: 60px; width: 60px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .sidebar-header .title { font-size: 24px; font-weight: 600; text-transform: uppercase; }
        .sidebar-header .close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; }
        .sidebar-links li a { color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; padding: 15px 20px; font-size: 16px; }
        .sidebar-footer { margin-top: auto; text-align: center; padding: 20px; font-size: 14px; color: #888; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 199; }
        .overlay.show { display: block; }
        
        .batch-card { display: block; background-color: var(--card-bg); border-radius: 12px; overflow: hidden; margin-bottom: 20px; text-decoration: none; color: var(--text-primary); }
        .batch-card img { width: 100%; height: 150px; object-fit: cover; display: block; }
        .batch-card .card-content { display: flex; align-items: center; justify-content: space-between; padding: 15px; }
        .batch-card .fav-icon { font-size: 20px; cursor: pointer; z-index: 10; }
        .fav-icon .fa-solid { display: none; color: #ff7e5f; }
        .is-favourite .fav-icon .fa-solid { display: inline-block; }
        .is-favourite .fav-icon .fa-regular { display: none; }

        .new-card { background-color: var(--card-bg); border-radius: 12px; margin-bottom: 15px; padding: 20px; text-decoration: none; color: var(--text-primary); display: block; }
        .new-subject-card { display: flex; align-items: center; gap: 20px; }
        .new-subject-card .icon { font-size: 24px; color: var(--button-active); }
        .new-subject-card .info .title { font-size: 16px; font-weight: 600; }
        .new-subject-card .info .subtitle { font-size: 12px; color: var(--text-secondary); }
        .new-chapter-card { border-left: 4px solid var(--button-active); }
        .new-chapter-card .title { font-size: 16px; font-weight: 600; margin-bottom: 15px; }
        .new-chapter-card .stats { display: flex; gap: 10px; flex-wrap: wrap; }
        .new-chapter-card .stat-item { background-color: var(--secondary-bg); padding: 5px 12px; border-radius: 15px; font-size: 12px; }
        
        .content-tabs { display: flex; gap: 15px; margin-bottom: 30px; }
        .content-tab-btn { padding: 8px 20px; background-color: var(--secondary-bg); border: none; color: var(--text-secondary); border-radius: 20px; cursor: pointer; }
        .content-tab-btn.active { background-color: var(--button-active); color: white; }
        .content-panel { display: none; }
        .content-panel.active { display: block; }
        .placeholder { color: var(--text-secondary); text-align: center; padding: 40px 0; }
        .placeholder i { font-size: 48px; margin-bottom: 15px; }
        .content-list-item { background-color: var(--card-bg); border-radius: 10px; margin-bottom: 10px; }
        .content-list-item a { text-decoration: none; color: var(--text-secondary); display: flex; align-items:center; gap: 15px; padding: 16px 20px; }
        
        @media (min-width: 600px) { #batch-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; } }
        @media (min-width: 900px) { #batch-list { grid-template-columns: repeat(3, 1fr); } }
    </style>
</head>
<body>
    <div id="loader" class="loader-overlay"><div class="spinner"></div></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fa-solid fa-xmark close-btn" id="close-btn"></i>
            <a id="sidebar-logo-link" href="#" target="_blank"><img src="" alt="Logo" class="logo"></a>
            <span class="title">CLASS11UP</span>
        </div>
        <ul class="sidebar-links">
            <li><a id="telegram-link" href="#" target="_blank"><i class="fa-brands fa-telegram"></i> Join Telegram</a></li>
            <li><a id="contact-link" href="#" target="_blank"><i class="fa-solid fa-headset"></i> Help & Support</a></li>
        </ul>
        <div class="sidebar-footer">Made with ❤️ in India by CLASS11UP</div>
    </aside>
    <div class="overlay" id="overlay"></div>
    
    <div id="home-page" class="page">
        <div class="main-container">
            <header class="page-header">
                <div class="header-left"><i class="fa-solid fa-bars icon-btn" id="menu-btn"></i></div>
                <h2 class="glowing-title">CLASS11UP</h2>
                <div class="header-right"><a id="header-logo-link" href="#" target="_blank"><img src="" alt="Logo" class="logo"></a></div>
            </header>
            <div class="search-container"><input type="text" class="search-input" id="batch-search" placeholder="Search batches..."></div>
            <div class="tabs" id="batch-tabs">
                <button class="tab-btn active" data-tab="total">All Batches</button>
                <button class="tab-btn" data-tab="favourites">Favourites</button>
            </div>
            <div id="batch-list"></div>
        </div>
    </div>
    
    <div id="subjects-page" class="page">
        <div class="main-container">
            <header class="inner-page-header"><a class="back-arrow" id="subjects-back-btn">&larr;</a><h2 class="title" id="subjects-page-title"></h2></header>
            <div id="subject-list"></div>
        </div>
    </div>
    
    <div id="chapters-page" class="page">
         <div class="main-container">
            <header class="inner-page-header"><a class="back-arrow" id="chapters-back-btn">&larr;</a><h2 class="title" id="chapters-page-title"></h2></header>
            <div id="chapter-list"></div>
        </div>
    </div>

    <div id="content-page" class="page">
        <div class="main-container">
            <header class="inner-page-header"><a class="back-arrow" id="content-back-btn">&larr;</a><h2 class="title" id="content-page-title"></h2></header>
            <div class="content-tabs" id="content-tabs"></div>
            <div id="content-area"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        const firebaseConfig = {
            apiKey: "AIzaSyC1m25mHpA59xBQmF34BfA1K_vY2pUSrLI",
            authDomain: "fahad-portfolio-81c65.firebaseapp.com",
            databaseURL: "https://fahad-portfolio-81c65-default-rtdb.firebaseio.com",
            projectId: "fahad-portfolio-81c65",
            storageBucket: "fahad-portfolio-81c65.firebasestorage.app",
            messagingSenderId: "510625882446",
            appId: "1:510625882446:web:b23f76808b3dd0e79a3e1f"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let allData = {};
        const loader = document.getElementById('loader');
        const allPages = document.querySelectorAll('.page');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        const showLoader = () => loader.classList.remove('hidden');
        const hideLoader = () => loader.classList.add('hidden');

        const navigateTo = (pageId, state = {}, addToHistory = true) => {
            showLoader();
            setTimeout(() => {
                allPages.forEach(p => p.classList.remove('active'));
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                    if (addToHistory && JSON.stringify(history.state) !== JSON.stringify({ page: pageId, ...state })) {
                        history.pushState({ page: pageId, ...state }, '', `#${pageId}`);
                    }
                    if (pageId === 'home-page') renderHomePage();
                    if (pageId === 'subjects-page') renderSubjects(state.batchId);
                    if (pageId === 'chapters-page') renderChapters(state.batchId, state.subjectId);
                    if (pageId === 'content-page') renderContent(state.batchId, state.subjectId, state.chapterId);
                }
                hideLoader();
            }, 100);
        };
        
        window.addEventListener('popstate', e => {
            const pageId = e.state ? e.state.page : 'home-page';
            navigateTo(pageId, e.state, false);
        });

        const initialHash = window.location.hash.substring(1).split('&')[0] || 'home-page';
        navigateTo(initialHash, history.state || {}, true);
        
        document.getElementById('subjects-back-btn').onclick = () => history.back();
        document.getElementById('chapters-back-btn').onclick = () => history.back();
        document.getElementById('content-back-btn').onclick = () => history.back();

        const closeSidebar = () => { sidebar.classList.remove('open'); overlay.classList.remove('show'); };
        document.getElementById('menu-btn').addEventListener('click', () => { sidebar.classList.add('open'); overlay.classList.add('show'); });
        document.getElementById('close-btn').addEventListener('click', closeSidebar);
        overlay.addEventListener('click', closeSidebar);

        onValue(ref(database), snapshot => {
            allData = snapshot.val() || { batches: {}, settings: {} };
            const currentPageState = history.state || { page: initialHash };
            navigateTo(currentPageState.page, currentPageState, false); 
            updateSettings();
            hideLoader();
        });
        
        const getObjectCount = obj => obj ? Object.keys(obj).length : 0;
        const subjectIcons = { default: 'fa-book', Physics: 'fa-atom', Chemistry: 'fa-flask', Notices: 'fa-bullhorn', Mathematics: 'fa-calculator', Biology: 'fa-dna', English: 'fa-spell-check' };

        const updateSettings = () => {
            const settings = allData.settings || {};
            const logoUrl = settings.logoLink || 'https://i.imgur.com/v8L6kK8.png'; // Default logo
            document.querySelectorAll('.logo').forEach(el => el.src = logoUrl);
            document.querySelectorAll('#header-logo-link, #sidebar-logo-link').forEach(el => el.href = settings.logoLink || '#');
            document.getElementById('telegram-link').href = settings.telegramLink || '#';
            document.getElementById('contact-link').href = settings.contactLink || '#';
        };
        
        const renderHomePage = () => {
            const batchListDiv = document.getElementById('batch-list');
            const searchInput = document.getElementById('batch-search');
            const batchTabs = document.getElementById('batch-tabs');
            batchListDiv.innerHTML = '';
            const favourites = JSON.parse(localStorage.getItem('favourites')) || [];
            const activeTab = batchTabs.querySelector('.tab-btn.active').dataset.tab;
            const searchTerm = searchInput.value.toLowerCase();
            const batches = allData.batches || {};

            for (const batchId in batches) {
                const batch = batches[batchId];
                const isFavourite = favourites.includes(batchId);
                if ((activeTab === 'favourites' && !isFavourite) || !batch.title.toLowerCase().includes(searchTerm)) continue;

                const card = document.createElement('div');
                card.className = `batch-card ${isFavourite ? 'is-favourite' : ''}`;
                card.innerHTML = `
                    <div class="nav-link" data-batch-id="${batchId}">
                        <img src="${batch.imageUrl}" alt="${batch.title}">
                    </div>
                    <div class="card-content">
                        <span class="title">${batch.title}</span>
                        <div class="fav-icon" data-id="${batchId}"><i class="fa-regular fa-heart"></i><i class="fa-solid fa-heart"></i></div>
                    </div>`;
                batchListDiv.appendChild(card);
            }
        };

        const renderSubjects = (batchId) => {
            const listDiv = document.getElementById('subject-list');
            listDiv.innerHTML = '';
            const batch = allData.batches?.[batchId];
            if (!batch) return;
            document.getElementById('subjects-page-title').textContent = batch.title;
            const subjects = batch.subjects || {};
            for(const subjectId in subjects){
                const subject = subjects[subjectId];
                const iconClass = subjectIcons[subject.title] || subjectIcons.default;
                const card = document.createElement('a');
                card.className = 'new-card new-subject-card';
                card.innerHTML = `<i class="fas ${iconClass} icon"></i><div class="info"><div class="title">${subject.title}</div><div class="subtitle">${getObjectCount(subject.chapters)} Chapters</div></div>`;
                card.onclick = () => navigateTo('chapters-page', { page: 'chapters-page', batchId, subjectId });
                listDiv.appendChild(card);
            }
        };

        const renderChapters = (batchId, subjectId) => {
            const listDiv = document.getElementById('chapter-list');
            listDiv.innerHTML = '';
            const subject = allData.batches?.[batchId]?.subjects?.[subjectId];
            if (!subject) return;
            document.getElementById('chapters-page-title').textContent = subject.title;
            const chapters = subject.chapters || {};
            for(const chapterId in chapters){
                const chapter = chapters[chapterId];
                const content = chapter.content || {};
                let videoCount = 0, noteCount = 0, dppCount = 0;
                Object.values(content).forEach(item => {
                    if(item.type === 'lecture') videoCount++;
                    if(item.type === 'note') noteCount++;
                    if(item.type === 'dpp') dppCount++;
                });

                const card = document.createElement('a');
                card.className = 'new-card new-chapter-card';
                card.innerHTML = `<div class="title">${chapter.title}</div><div class="stats"><span class="stat-item"><i class="fas fa-video"></i> ${videoCount} Videos</span><span class="stat-item"><i class="fas fa-file-alt"></i> ${noteCount} Notes</span><span class="stat-item"><i class="fas fa-pencil-alt"></i> ${dppCount} DPP</span></div>`;
                card.onclick = () => navigateTo('content-page', { page: 'content-page', batchId, subjectId, chapterId, chapterTitle: chapter.title });
                listDiv.appendChild(card);
            }
        };
        
        const renderContent = (batchId, subjectId, chapterId) => {
            const chapter = allData.batches?.[batchId]?.subjects?.[subjectId]?.chapters?.[chapterId];
            const contentTabsDiv = document.getElementById('content-tabs');
            const contentAreaDiv = document.getElementById('content-area');
            contentTabsDiv.innerHTML = '';
            contentAreaDiv.innerHTML = '';
            if(!chapter) { contentAreaDiv.innerHTML = `<div class="placeholder"><i class="fas fa-exclamation-circle"></i> Not Found.</div>`; return; }
            document.getElementById('content-page-title').textContent = chapter.title;

            const contentByType = { lecture: [], note: [], dpp: [] };
            const tabNames = { lecture: "Lectures", note: "Notes", dpp: "DPP" };
            
            if(chapter.content) Object.values(chapter.content).forEach(item => { if(contentByType[item.type]) contentByType[item.type].push(item); });
            
            let isFirstTab = true;
            for(const type in tabNames){
                const btn = document.createElement('button');
                btn.className = 'content-tab-btn';
                btn.textContent = tabNames[type];
                btn.dataset.type = type;
                
                const panel = document.createElement('div');
                panel.id = `${type}-panel`;
                panel.className = 'content-panel';

                if(contentByType[type].length > 0){
                    if(isFirstTab){ btn.classList.add('active'); panel.classList.add('active'); isFirstTab = false; }
                    contentByType[type].forEach(item => {
                        const iconClass = item.type === 'lecture' ? 'fa-play-circle' : 'fa-file-pdf';
                        panel.innerHTML += `<div class="content-list-item"><a href="${item.url}" target="_blank" rel="noopener noreferrer"><i class="fas ${iconClass}"></i> ${item.title}</a></div>`;
                    });
                } else {
                     panel.innerHTML = `<div class="placeholder"><i class="fas fa-exclamation-circle"></i> Not Available</div>`;
                }
                contentTabsDiv.appendChild(btn);
                contentAreaDiv.appendChild(panel);
            }
            
            if (!document.querySelector('.content-tab-btn.active') && contentTabsDiv.children[0]) {
                contentTabsDiv.children[0].classList.add('active');
                contentAreaDiv.children[0].classList.add('active');
            }
            
            contentTabsDiv.onclick = (e) => {
                if(e.target.matches('.content-tab-btn')){
                    contentTabsDiv.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
                    document.getElementById(e.target.dataset.type + '-panel').classList.add('active');
                }
            };
        };

        document.getElementById('batch-search').addEventListener('input', renderHomePage);
        document.getElementById('batch-tabs').addEventListener('click', e => {
            if (e.target.classList.contains('tab-btn')) {
                document.querySelector('#batch-tabs .active').classList.remove('active');
                e.target.classList.add('active');
                renderHomePage();
            }
        });
        document.getElementById('batch-list').addEventListener('click', e => {
            const favIcon = e.target.closest('.fav-icon');
            if (favIcon) {
                const batchId = favIcon.dataset.id;
                let favourites = JSON.parse(localStorage.getItem('favourites')) || [];
                if (favourites.includes(batchId)) {
                    favourites = favourites.filter(id => id !== batchId);
                } else {
                    favourites.push(batchId);
                }
                localStorage.setItem('favourites', JSON.stringify(favourites));
                renderHomePage();
            } else if (e.target.closest('.nav-link')) {
                const navLink = e.target.closest('.nav-link');
                navigateTo('subjects-page', { page: 'subjects-page', batchId: navLink.dataset.batchId });
            }
        });
    </script>
</body>
</html>
