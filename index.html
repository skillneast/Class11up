<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASS11UP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #141b2d; --secondary-bg: #1f2a40; --card-bg: #293651;
            --button-active: #868dfb; --text-primary: #ffffff; --text-secondary: #b0b8d3;
            --glow-1: #00aaff; --glow-2: #8A2BE2; --glow-3: #00ffc3;
            --purple-glow: rgba(138, 43, 226, 0.6);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-primary); overflow-x: hidden; }
        .page { display: none; min-height: 100vh; }
        .page.active { display: block; animation: page-enter 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }
        @keyframes page-enter {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .main-container { padding: 20px; }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding: 0 5px; }
        .header .icon-btn, .header .back-arrow { font-size: 22px; cursor: pointer; width: 40px; text-align: center; text-decoration: none; color: var(--text-primary); z-index: 10; }
        .header .logo { height: 40px; width: 40px; border-radius: 50%; object-fit: cover; }
        .glowing-title {
            font-size: 24px; font-weight: 700; color: transparent; text-transform: uppercase;
            background: linear-gradient(90deg, var(--glow-1), var(--glow-2), var(--glow-3), var(--glow-1));
            background-size: 200% auto; -webkit-background-clip: text; background-clip: text;
            animation: gradient-flow 8s linear infinite;
            text-shadow: 0 0 3px rgba(255,255,255,0.4), 0 0 8px var(--glow-2), 0 0 15px var(--glow-1);
        }
        @keyframes gradient-flow { to { background-position: -200% center; } }
        
        .search-container { position: relative; margin-bottom: 20px; }
        .search-input { width: 100%; background-color: var(--secondary-bg); border: 2px solid transparent; border-radius: 10px; padding: 15px 20px; color: var(--text-primary); font-size: 16px; transition: border-color 0.3s; }
        .search-input:focus { border-color: var(--button-active); outline: none; }
        .tabs { display: flex; background-color: var(--secondary-bg); border-radius: 10px; padding: 5px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; background: none; border: none; color: var(--text-secondary); font-size: 16px; font-weight: 500; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .tab-btn.active { background-color: var(--button-active); color: white; transform: scale(1.05); }

        .sidebar { position: fixed; top: 0; left: -280px; width: 270px; height: 100%; background-color: var(--secondary-bg); transition: left 0.3s; z-index: 200; display: flex; flex-direction: column; padding: 20px 0; }
        .sidebar.open { left: 0; }
        .sidebar-header { text-align: center; padding: 0 20px; margin-bottom: 20px; }
        .sidebar-header .logo { height: 60px; width: 60px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .sidebar-header .title { font-size: 24px; font-weight: 600; }
        .sidebar-header .close-btn { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; }
        .sidebar-links li a { color: var(--text-secondary); text-decoration: none; display: flex; align-items: center; padding: 15px 20px; font-size: 16px; transition: background-color 0.2s, color 0.2s; }
        .sidebar-links li a:hover { background-color: var(--button-active); color: white; }
        .sidebar-links li a i { margin-right: 15px; width: 20px; }
        .sidebar-footer { margin-top: auto; text-align: center; padding: 20px; font-size: 14px; color: #888; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 199; transition: opacity 0.3s; }
        .overlay.show { display: block; }
        
        .shine-effect { position: relative; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; }
        .shine-effect:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2), 0 0 15px var(--purple-glow); }
        .shine-effect::after { content: ''; position: absolute; top: 0; left: -150%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); transition: left 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .shine-effect:hover::after { left: 150%; }

        .batch-card { display: block; background-color: var(--card-bg); border-radius: 12px; margin-bottom: 20px; text-decoration: none; color: var(--text-primary); }
        .batch-card img { width: 100%; height: 150px; object-fit: cover; display: block; border-bottom: 1px solid var(--secondary-bg); }
        .batch-card .card-content { display: flex; align-items: center; justify-content: space-between; padding: 15px; }
        .batch-card .fav-icon { font-size: 20px; cursor: pointer; z-index: 10; }
        .fav-icon .fa-solid { display: none; color: #ff7e5f; }
        .is-favourite .fav-icon .fa-solid { display: inline-block; }
        .is-favourite .fav-icon .fa-regular { display: none; }
        
        .simple-card { background-color: var(--card-bg); border-radius: 12px; margin-bottom: 15px; }
        .simple-card a { display: block; padding: 20px; text-decoration: none; color: var(--text-primary); }
        
        /* --- FIXED CONTENT TABS --- */
        .content-tabs { display: flex; justify-content: space-around; align-items: center; margin-bottom: 30px; }
        .content-tab-btn {
            height: 80px; width: 80px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: var(--secondary-bg); border: 2px solid transparent;
            color: var(--text-secondary); font-weight: 600; cursor: pointer;
            transition: all 0.3s ease;
        }
        .content-tab-btn.active { background: var(--button-active); color: white; border-color: var(--purple-glow); }
        .content-tab-btn:hover { box-shadow: 0 0 15px var(--purple-glow); transform: scale(1.1); }
        
        .content-panel { display: none; }
        .content-panel.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn{ from {opacity: 0;} to {opacity: 1;} }
        .content-list-item { background-color: var(--card-bg); border-radius: 10px; margin-bottom: 10px; }
        .content-list-item a { text-decoration: none; color: var(--text-secondary); display: block; padding: 16px 20px; transition: background-color 0.2s, padding-left 0.2s; }
        .content-list-item a:hover { background-color: var(--secondary-bg); padding-left: 25px; }

    </style>
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fa-solid fa-xmark close-btn" id="close-btn"></i>
            <a id="sidebar-logo-link" href="#" target="_blank"><img src="" alt="Logo" class="logo"></a>
            <span class="title">CLASS11UP</span>
        </div>
        <ul class="sidebar-links">
            <li><a id="telegram-link" href="#" target="_blank"><i class="fa-brands fa-telegram"></i> Join Telegram</a></li>
            <li><a id="contact-link" href="#" target="_blank"><i class="fa-solid fa-headset"></i> Help & Support</a></li>
        </ul>
        <div class="sidebar-footer">Made with ❤️ in India by CLASS11UP</div>
    </aside>
    <div class="overlay" id="overlay"></div>

    <div id="home-page" class="page">
        <div class="main-container">
            <header class="header">
                <i class="fa-solid fa-bars icon-btn" id="menu-btn"></i>
                <h2 class="glowing-title">CLASS11UP</h2>
                <a id="header-logo-link" href="#" target="_blank"><img src="" alt="Logo" class="logo"></a>
            </header>
            <div class="search-container"><input type="text" class="search-input" id="batch-search" placeholder="Search batches..."></div>
            <div class="tabs" id="batch-tabs">
                <button class="tab-btn active" data-tab="total">All Batches</button>
                <button class="tab-btn" data-tab="favourites">Favourites</button>
            </div>
            <div id="batch-list"></div>
        </div>
    </div>

    <div id="subjects-page" class="page">
         <div class="main-container">
            <header class="header"><a class="back-arrow" id="subjects-back-btn">&larr;</a><h2 class="title" id="subjects-page-title">Subjects</h2><span class="icon-btn"></span></header>
            <div id="subject-list"></div>
        </div>
    </div>
    <div id="content-page" class="page">
        <div class="main-container">
            <header class="header"><a class="back-arrow" id="content-back-btn">&larr;</a><h2 class="title" id="content-page-title">Content</h2><span class="icon-btn"></span></header>
            <div class="content-tabs" id="content-tabs">
                <button class="content-tab-btn active" data-panel="lecture">Lectures</button>
                <button class="content-tab-btn" data-panel="note">Notes</button>
                <button class="content-tab-btn" data-panel="dpp">DPP</button>
            </div>
            <div id="lecture-panel" class="content-panel active"></div>
            <div id="note-panel" class="content-panel"></div>
            <div id="dpp-panel" class="content-panel"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        const firebaseConfig = {
            apiKey: "AIzaSyC1m25mHpA59xBQmF34BfA1K_vY2pUSrLI",
            authDomain: "fahad-portfolio-81c65.firebaseapp.com",
            databaseURL: "https://fahad-portfolio-81c65-default-rtdb.firebaseio.com",
            projectId: "fahad-portfolio-81c65",
            storageBucket: "fahad-portfolio-81c65.firebasestorage.app",
            messagingSenderId: "510625882446",
            appId: "1:510625882446:web:b23f76808b3dd0e79a3e1f"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let allData = {};
        const allPages = document.querySelectorAll('.page');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        const navigateTo = (pageId, state = {}, addToHistory = true) => {
            allPages.forEach(p => p.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                if (addToHistory && (history.state?.page !== pageId || history.state?.subjectId !== state.subjectId)) {
                    history.pushState({ page: pageId, ...state }, '', `#${pageId}`);
                }
                if (pageId === 'subjects-page') renderSubjects(state.batchId);
                if (pageId === 'content-page') renderContent(state.batchId, state.subjectId, state.subjectTitle);
            }
        };
        
        window.addEventListener('popstate', e => {
            const pageId = e.state ? e.state.page : 'home-page';
            navigateTo(pageId, e.state, false);
        });

        const initialHash = window.location.hash.substring(1);
        navigateTo(initialHash || 'home-page', {}, false);
        
        document.getElementById('subjects-back-btn').onclick = () => history.back();
        document.getElementById('content-back-btn').onclick = () => history.back();

        const closeSidebar = () => { sidebar.classList.remove('open'); overlay.classList.remove('show'); };
        document.getElementById('menu-btn').addEventListener('click', () => { sidebar.classList.add('open'); overlay.classList.add('show'); });
        document.getElementById('close-btn').addEventListener('click', closeSidebar);
        overlay.addEventListener('click', closeSidebar);

        onValue(ref(database), snapshot => {
            allData = snapshot.val() || { batches: {}, settings: {} };
            renderHomePage();
            updateSettings();
        });

        const updateSettings = () => {
            const settings = allData.settings || {};
            const logoUrl = settings.logoLink || 'https://i.imgur.com/v8L6kK8.png';
            document.querySelectorAll('.logo').forEach(el => el.src = logoUrl);
            document.querySelectorAll('#header-logo-link, #sidebar-logo-link').forEach(el => el.href = settings.logoLink || '#');
            document.getElementById('telegram-link').href = settings.telegramLink || '#';
            document.getElementById('contact-link').href = settings.contactLink || '#';
        };

        const renderHomePage = () => {
            const batchListDiv = document.getElementById('batch-list');
            const searchInput = document.getElementById('batch-search');
            const batchTabs = document.getElementById('batch-tabs');
            batchListDiv.innerHTML = '';
            const favourites = JSON.parse(localStorage.getItem('favourites')) || [];
            const activeTab = batchTabs.querySelector('.tab-btn.active').dataset.tab;
            const searchTerm = searchInput.value.toLowerCase();
            const batches = allData.batches || {};

            for (const batchId in batches) {
                const batch = batches[batchId];
                const isFavourite = favourites.includes(batchId);
                if ((activeTab === 'favourites' && !isFavourite) || !batch.title.toLowerCase().includes(searchTerm)) continue;

                const card = document.createElement('div');
                card.className = `batch-card shine-effect ${isFavourite ? 'is-favourite' : ''}`;
                card.innerHTML = `
                    <div class="nav-link" data-batch-id="${batchId}" data-target="subjects-page">
                        <img src="${batch.imageUrl}" alt="${batch.title}">
                    </div>
                    <div class="card-content">
                        <span class="title">${batch.title}</span>
                        <div class="fav-icon" data-id="${batchId}"><i class="fa-regular fa-heart"></i><i class="fa-solid fa-heart"></i></div>
                    </div>`;
                batchListDiv.appendChild(card);
            }
        };

        document.getElementById('batch-search').addEventListener('input', renderHomePage);
        document.getElementById('batch-tabs').addEventListener('click', e => {
            if (e.target.classList.contains('tab-btn')) {
                document.querySelector('#batch-tabs .active').classList.remove('active');
                e.target.classList.add('active');
                renderHomePage();
            }
        });
        document.getElementById('batch-list').addEventListener('click', e => {
            const favIcon = e.target.closest('.fav-icon');
            if (favIcon) {
                const batchId = favIcon.dataset.id;
                let favourites = JSON.parse(localStorage.getItem('favourites')) || [];
                if (favourites.includes(batchId)) {
                    favourites = favourites.filter(id => id !== batchId);
                } else {
                    favourites.push(batchId);
                }
                localStorage.setItem('favourites', JSON.stringify(favourites));
                renderHomePage();
            } else if (e.target.closest('.nav-link')) {
                const navLink = e.target.closest('.nav-link');
                navigateTo('subjects-page', { page: 'subjects-page', batchId: navLink.dataset.batchId });
            }
        });

        const renderSubjects = batchId => {
            const subjectListDiv = document.getElementById('subject-list');
            subjectListDiv.innerHTML = '';
            const batch = allData.batches?.[batchId];
            if (!batch) return;
            document.getElementById('subjects-page-title').textContent = "Subjects";
            const subjects = batch.subjects || {};
            for(const subjectId in subjects){
                const subject = subjects[subjectId];
                const card = document.createElement('div');
                card.className = 'simple-card shine-effect';
                card.innerHTML = `<a>${subject.title}</a>`;
                card.onclick = () => navigateTo('content-page', { page: 'content-page', batchId: batchId, subjectId: subjectId, subjectTitle: subject.title });
                subjectListDiv.appendChild(card);
            }
        };
        
        const renderContent = (batchId, subjectId, subjectTitle) => {
            const subject = allData.batches?.[batchId]?.subjects?.[subjectId];
            if(!subject) return;
            document.getElementById('content-page-title').textContent = subjectTitle || "Content";
            const content = subject.content || {};
            const panels = { lecture: '', note: '', dpp: '' };
            for(const contentId in content){
                const item = content[contentId];
                const itemHTML = `<div class="content-list-item"><a href="${item.url}" target="_blank" rel="noopener noreferrer">${item.title}</a></div>`;
                if(panels[item.type] !== undefined) panels[item.type] += itemHTML;
            }
            for(const type in panels) document.getElementById(`${type}-panel`).innerHTML = panels[type] || '<p style="text-align:center; padding: 20px;">No content available.</p>';
        };
        
        document.getElementById('content-tabs').addEventListener('click', e => {
            if(e.target.matches('.content-tab-btn')) {
                document.querySelector('#content-tabs .active').classList.remove('active');
                e.target.classList.add('active');
                document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
                document.getElementById(e.target.dataset.panel + '-panel').classList.add('active');
            }
        });
    </script>
</body>
</html>